--- data/CMakeLists.txt.orig	2019-05-01 16:08:39.000000000 -0600
+++ data/CMakeLists.txt	2019-05-31 19:03:50.810825000 -0600
@@ -1,3 +1,4 @@
+if(ENABLE_APPMENU_COMMON)
 add_custom_target(data-files-module SOURCES org.appmenu.gtk-module.gschema.xml appmenu-gtk-module.service)
 
 add_schema("org.appmenu.gtk-module.gschema.xml" "bin")
@@ -8,13 +9,18 @@ elseif (NOT SYSTEMD_FOUND AND SYSTEMD_SERVICES_INSTALL
     message (FATAL_ERROR "Variable SYSTEMD_SERVICES_INSTALL_DIR is\
         defined, but we can't find systemd using pkg-config")
 endif()
+
+endif() # ENABLE_APPMENU_COMMON
+
 configure_file(appmenu-gtk2-parser.pc.in ${CMAKE_CURRENT_BINARY_DIR}/appmenu-gtk2-parser.pc @ONLY)
 configure_file(appmenu-gtk3-parser.pc.in ${CMAKE_CURRENT_BINARY_DIR}/appmenu-gtk3-parser.pc @ONLY)
 configure_file(appmenu-gtk-module.service.in ${CMAKE_CURRENT_BINARY_DIR}/appmenu-gtk-module.service @ONLY)
-install(FILES ${CMAKE_CURRENT_BINARY_DIR}/appmenu-gtk3-parser.pc DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)
-if(GTK2_FOUND)
+if(APPMENU_GTK3_MODULE)
+    install(FILES ${CMAKE_CURRENT_BINARY_DIR}/appmenu-gtk3-parser.pc DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)
+endif()
+if(APPMENU_GTK2_MODULE)
     install(FILES ${CMAKE_CURRENT_BINARY_DIR}/appmenu-gtk2-parser.pc DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)
 endif()
-if (SYSTEMD_FOUND)
+if (ENABLE_APPMENU_DATA AND SYSTEMD_FOUND)
     install(FILES ${CMAKE_CURRENT_BINARY_DIR}/appmenu-gtk-module.service DESTINATION ${SYSTEMD_SERVICES_INSTALL_DIR})
 endif()
